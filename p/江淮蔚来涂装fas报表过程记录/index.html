<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='修改需求： 设备报警TOP 第二列加上DvcCd,搜索条件去掉故障说明，表格上方加入柱状图（按DvcCd分组计算）
车身工艺参数 采集名称做下拉框
ANDON 1.Andon拉绳时长top10 --参考安驰报表-当天ANDON停线时长TOP10 select distinct PlineNm--”产线名称“ , sum(cast(SUBSTRING(SLContTm,1,2) as int) )*60&#43;sum( cast(SUBSTRING(SLContTm,4,2) as int))&#43;sum(cast(SUBSTRING(SLContTm,7,2) as int))/60as分--将停线持续时间转换为以“分“为单位 from BPIE_SLDoc --停线日志表 where sLContTm is not null --”持续时间“非空and Enabled=1 and datediff(day,sLStrtTm, &amp;#39;$igetdate} &amp;#39;)=o --将”停线开始时间“转换为参数面板中的查询时间的格式并与之对应group by PlineNm --以”产线名称“分组 order by分DESC --以处避”持续时间“为”分进行排序 查A_AndonManagement_Pro a LEFT JOIN A_AndonInfo_Record b ON a.AndonId =b.AndonId ，按照输入的时间范围以PlinCd分组查询，以累加的时长[AndonDurationTime]排序
Andon的报表可以用产线编号查BBdbR_PlineBase把Enabled=1产线名称查出来作为横坐标
数据结构分析
在停线信息管理过程表中，“持续时间”&amp;ndash;AndonDurationTime 的单位为秒 在查询结果的处理中需要处理为分钟
--SQL语句 无TOP 10 查询版本 --产线名称为横坐标 SELECT DISTINCT PlineNm,SUM(AndonDurationTime)/60 AS 分 FROM A_AndonManagement_Pro a LEFT JOIN BBdbR_PlineBase b ON a.'><title>江淮蔚来涂装FAS报表过程记录</title>

<link rel='canonical' href='https://jianrongma.github.io/p/%E6%B1%9F%E6%B7%AE%E8%94%9A%E6%9D%A5%E6%B6%82%E8%A3%85fas%E6%8A%A5%E8%A1%A8%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/'>

<link rel="stylesheet" href="/scss/style.min.css">
<style>
     
    body{
        background-repeat: repeat;
        background-attachment: fixed;
        background-size:cover;
         cursor: url(https://files.cnblogs.com/files/monster-jian/cursor.ico),auto;
    }
     
    #div_digg {
      position: fixed;
      bottom: 10px;
      right: 15px;
      border: 2px solid #ECD7B1;
      padding: 10px;
      width: 140px;
      background-color: #fff;
      border-radius: 5px 5px 5px 5px !important;
      box-shadow: 0 0 0 1px #5F5A4B, 1px 1px 6px 1px rgba(10, 10, 0, 0.5);
    }
    </style><script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

<script src="https://files.cnblogs.com/files/liyhbk/js.js" color="0,0,255" opacity="1" count="119" zindex="-2"></script>
<script src="https://files.cnblogs.com/files/liyhbk/js.js" color="0,0,255" opacity="1" count="119" zindex="-2">
</script>
<script type="text/javascript" color="255,0,0" pointcolor="255,0,0" opacity="0.7" zindex="-2" count="100" src="/dist/canvas-nest.js"></script>
<script type="text/javascript" src="/dist/canvas-nest.umd.js"></script>
<script type="text/javascript">
    var cn = new CanvasNest(document.getElementById('area-render'), {
        color: '255,0,255',
        count: 50,
      });
      
      function asyncLoad() {
        
        var i = document.createElement("iframe");
        i.src = "https://ghbtns.com/github-btn.html?user=hustcc&repo=canvas-nest.js&type=star&count=true";
        i.scrolling = "no";
        i.frameborder = "0";
        i.border = "0";
        i.setAttribute("frameborder", "0", 0);
        i.width = "100px";
        i.height = "20px";
        document.getElementById("github-iframe").appendChild(i);
      }
      function loadGitHubBtn() {
        if (window.addEventListener) {window.addEventListener("load", asyncLoad, false);}
        else if (window.attachEvent) {window.attachEvent("onload", asyncLoad);}
        else {window.onload = asyncLoad;}
      }
      loadGitHubBtn();
</script>
<script src="/canvas-nest.js?version=10"></script><canvas width="1536" height="454" style="display: block; position: absolute; top: 0px; left: 0px; height: 100%; width: 100%; overflow: hidden; pointer-events: none;"></canvas>
<script src="https://files.cnblogs.com/files/monster-jian/mouse-click.js"></script>
<script type="text/javascript">
    
     
    var a_idx = 0;
    jQuery(document).ready(function($) {
        $("body").click(function(e) {
            var a = new Array("❤不做咸鱼！❤","❤拒绝懒惰！❤","❤想做吃货❤","❤向大佬学习❤","❤扶我起来~❤","❤come on❤","❤一直在路上~❤","❤累了~❤","❤再趴一会❤","❤66666❤","❤高兴的飞起*****❤");
            var $i = $("<span></span>").text(a[a_idx]);
            a_idx = (a_idx + 1) % a.length;
            var x = e.pageX,
            y = e.pageY;
            $i.css({
                "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
                "top": y - 20,
                "left": x,
                "position": "absolute",
                "font-weight": "bold",
                "color": "rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"
            });
            $("body").append($i);
            $i.animate({
                "top": y - 180,
                "opacity": 0
            },
            1500,
            function() {
                $i.remove();
            });
        });
    });
    </script>

    <script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script>  

 
   
      
      
          
         <script>         
            L2Dwidget.init({ "model": { jsonPath:          "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",  
                  "scale": 1 }, "display": { "position": "right", "width": 66, "height": 88,        "hOffset": 0, "vOffset": -20 },
                   "mobile": { "show": true, "scale": 0.5 },      "react": { "opacityDefault": 0.8, "opacityOnHover": 0.1 } }); 
                    </script><meta property='og:title' content='江淮蔚来涂装FAS报表过程记录'>
<meta property='og:description' content='修改需求： 设备报警TOP 第二列加上DvcCd,搜索条件去掉故障说明，表格上方加入柱状图（按DvcCd分组计算）
车身工艺参数 采集名称做下拉框
ANDON 1.Andon拉绳时长top10 --参考安驰报表-当天ANDON停线时长TOP10 select distinct PlineNm--”产线名称“ , sum(cast(SUBSTRING(SLContTm,1,2) as int) )*60&#43;sum( cast(SUBSTRING(SLContTm,4,2) as int))&#43;sum(cast(SUBSTRING(SLContTm,7,2) as int))/60as分--将停线持续时间转换为以“分“为单位 from BPIE_SLDoc --停线日志表 where sLContTm is not null --”持续时间“非空and Enabled=1 and datediff(day,sLStrtTm, &amp;#39;$igetdate} &amp;#39;)=o --将”停线开始时间“转换为参数面板中的查询时间的格式并与之对应group by PlineNm --以”产线名称“分组 order by分DESC --以处避”持续时间“为”分进行排序 查A_AndonManagement_Pro a LEFT JOIN A_AndonInfo_Record b ON a.AndonId =b.AndonId ，按照输入的时间范围以PlinCd分组查询，以累加的时长[AndonDurationTime]排序
Andon的报表可以用产线编号查BBdbR_PlineBase把Enabled=1产线名称查出来作为横坐标
数据结构分析
在停线信息管理过程表中，“持续时间”&amp;ndash;AndonDurationTime 的单位为秒 在查询结果的处理中需要处理为分钟
--SQL语句 无TOP 10 查询版本 --产线名称为横坐标 SELECT DISTINCT PlineNm,SUM(AndonDurationTime)/60 AS 分 FROM A_AndonManagement_Pro a LEFT JOIN BBdbR_PlineBase b ON a.'>
<meta property='og:url' content='https://jianrongma.github.io/p/%E6%B1%9F%E6%B7%AE%E8%94%9A%E6%9D%A5%E6%B6%82%E8%A3%85fas%E6%8A%A5%E8%A1%A8%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/'>
<meta property='og:site_name' content='think hy how to learn'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2022-04-10T10:31:06&#43;08:00'/><meta property='article:modified_time' content='2022-04-10T10:31:06&#43;08:00'/><meta property='og:image' content='https://jianrongma.github.io/img/avatar.png' />
<meta name="twitter:site" content="@ljsljs56495989">
    <meta name="twitter:creator" content="@ljsljs56495989"><meta name="twitter:title" content="江淮蔚来涂装FAS报表过程记录">
<meta name="twitter:description" content="修改需求： 设备报警TOP 第二列加上DvcCd,搜索条件去掉故障说明，表格上方加入柱状图（按DvcCd分组计算）
车身工艺参数 采集名称做下拉框
ANDON 1.Andon拉绳时长top10 --参考安驰报表-当天ANDON停线时长TOP10 select distinct PlineNm--”产线名称“ , sum(cast(SUBSTRING(SLContTm,1,2) as int) )*60&#43;sum( cast(SUBSTRING(SLContTm,4,2) as int))&#43;sum(cast(SUBSTRING(SLContTm,7,2) as int))/60as分--将停线持续时间转换为以“分“为单位 from BPIE_SLDoc --停线日志表 where sLContTm is not null --”持续时间“非空and Enabled=1 and datediff(day,sLStrtTm, &amp;#39;$igetdate} &amp;#39;)=o --将”停线开始时间“转换为参数面板中的查询时间的格式并与之对应group by PlineNm --以”产线名称“分组 order by分DESC --以处避”持续时间“为”分进行排序 查A_AndonManagement_Pro a LEFT JOIN A_AndonInfo_Record b ON a.AndonId =b.AndonId ，按照输入的时间范围以PlinCd分组查询，以累加的时长[AndonDurationTime]排序
Andon的报表可以用产线编号查BBdbR_PlineBase把Enabled=1产线名称查出来作为横坐标
数据结构分析
在停线信息管理过程表中，“持续时间”&amp;ndash;AndonDurationTime 的单位为秒 在查询结果的处理中需要处理为分钟
--SQL语句 无TOP 10 查询版本 --产线名称为横坐标 SELECT DISTINCT PlineNm,SUM(AndonDurationTime)/60 AS 分 FROM A_AndonManagement_Pro a LEFT JOIN BBdbR_PlineBase b ON a."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://jianrongma.github.io/img/avatar.png' />
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <style>
            * {
              margin: 0;
              padding: 0;
            }
            html, body {
              height: 100%;
              width: 100%;
            }
            #github-iframe {
              position: fixed;
              left: 32px;
              top: 32px;
            }
             
        </style>
   


<link rel="stylesheet" type="texts" href="https://blog-static.cnblogs.com/files/monster-jian/waifu.css"/>


</head>







<script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1280473365'%3E%3C/span%3E%3Cscript src='https://s9.cnzz.com/z_stat.php%3Fid%3D1280473365%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>

<body size-sensor-id="1" style="position: relative;">
    
    <div id="area-render"></div>
   

</body>

<canvas width="1777" height="841" style="position: fixed; left: 0px; top: 0px; z-index: 2147483647; pointer-events: none;"></canvas>

</html>


    </head>
    <body class="
    article-page 
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        on-phone--column extended
    
">
    
        <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/img/hanbagui_hu1992e2ef3ca17530e3489d97af7cbea6_3164_300x0_resize_box.bmp" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        <h1 class="site-name"><a href="https://jianrongma.github.io/">think hy how to learn</a></h1>
        <h2 class="site-description">好运暴富,就在今日.</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>暗色模式</span>
            </li>
        
    </ol>
</aside>

    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/-%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/" >
                -项目相关
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/%E6%B1%9F%E6%B7%AE%E8%94%9A%E6%9D%A5%E6%B6%82%E8%A3%85fas%E6%8A%A5%E8%A1%A8%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/">江淮蔚来涂装FAS报表过程记录</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 10, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 16 分钟
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h3 id="修改需求">修改需求：</h3>
<h4 id="设备报警top">设备报警TOP</h4>
<p>第二列加上DvcCd,搜索条件去掉故障说明，表格上方加入柱状图（按DvcCd分组计算）</p>
<h4 id="车身工艺参数">车身工艺参数</h4>
<p>采集名称做下拉框</p>
<h2 id="andon">ANDON</h2>
<h3 id="1andon拉绳时长top10">1.Andon拉绳时长top10</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--参考安驰报表-当天ANDON停线时长TOP10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">PlineNm</span><span class="c1">--”产线名称“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">SLContTm</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">int</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">+</span><span class="k">sum</span><span class="p">(</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">SLContTm</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">int</span><span class="p">))</span><span class="o">+</span><span class="k">sum</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">SLContTm</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">int</span><span class="p">))</span><span class="o">/</span><span class="mi">60</span><span class="n">as</span><span class="err">分</span><span class="c1">--将停线持续时间转换为以“分“为单位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">from</span><span class="w"> </span><span class="n">BPIE_SLDoc</span><span class="w"> </span><span class="c1">--停线日志表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="n">sLContTm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="c1">--”持续时间“非空and Enabled=1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">and</span><span class="w"> </span><span class="n">datediff</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="n">sLStrtTm</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$igetdate} &#39;</span><span class="p">)</span><span class="o">=</span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--将”停线开始时间“转换为参数面板中的查询时间的格式并与之对应group by PlineNm --以”产线名称“分组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">order</span><span class="w"> </span><span class="n">by</span><span class="err">分</span><span class="k">DESC</span><span class="w"> </span><span class="c1">--以处避”持续时间“为”分进行排序
</span></span></span></code></pre></div><ul>
<li>
<p>查A_AndonManagement_Pro a LEFT JOIN A_AndonInfo_Record b ON a.AndonId =b.AndonId ，按照输入的时间范围以PlinCd分组查询，以累加的时长[AndonDurationTime]排序</p>
</li>
<li>
<p>Andon的报表可以用产线编号查<strong>BBdbR_PlineBase</strong>把Enabled=1产线名称查出来作为横坐标</p>
</li>
<li>
<p>数据结构分析</p>
<p>在停线信息管理过程表中，“持续时间”&ndash;AndonDurationTime 的单位为秒 在查询结果的处理中需要处理为分钟</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--SQL语句 无TOP 10 查询版本
</span></span></span><span class="line"><span class="cl"><span class="c1">--产线名称为横坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">PlineNm</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">AndonDurationTime</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">A_AndonManagement_Pro</span><span class="w"> </span><span class="n">a</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">b</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PlineCd</span><span class="w"> </span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">PlineCd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">AndonDurationTime</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AndonStartTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-09-20&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PlineNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">DESC</span><span class="w">  </span><span class="c1">---DESC 降序排列
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--SQL语句 TOP 10 查询版本
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">PlineNm</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">AndonDurationTime</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">A_AndonManagement_Pro</span><span class="w"> </span><span class="n">a</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">b</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PlineCd</span><span class="w"> </span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">PlineCd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Type</span><span class="o">=</span><span class="s1">&#39;产线&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">isFile</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">AndonDurationTime</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AndonStartTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;${getdate}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PlineNm</span><span class="p">)</span><span class="w"> </span><span class="n">T</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><h3 id="2andon拉绳次数top10">2.Andon拉绳次数TOP10</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--拉停次数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">PlineNm</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">次数</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">A_AndonManagement_Pro</span><span class="w"> </span><span class="n">a</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">b</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PlineCd</span><span class="w"> </span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">PlineCd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Type</span><span class="o">=</span><span class="s1">&#39;产线&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">isFile</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AndonStartTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-09-21&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PlineNm</span><span class="p">)</span><span class="w"> </span><span class="n">T</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">次数</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><h2 id="设备报警">设备报警</h2>
<h3 id="3设备报警记录时长top-n">3.设备报警记录时长Top ‘n’</h3>
<h4 id="需求分析">需求分析</h4>
<p>图表样式&ndash;表格</p>
<p>可以选择top的是 DvcCd 或者是FaultDsc</p>
<p>还有TOP多少</p>
<p>GROUP BY FaultDsc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="err">${</span><span class="n">textEditortopN</span><span class="err">}</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">DefectId</span><span class="p">)</span><span class="err">缺陷数量</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CarType</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="p">(</span><span class="n">nolock</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PostId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="w"> </span><span class="o">&gt;=</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="w"> </span><span class="o">&lt;=</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxPlineNm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PlineNm</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxPlineNm}%&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxCarType}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxCarType}%&#39;</span><span class="p">)</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">缺陷数量</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--SQL 1.0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">DvcId</span><span class="p">,</span><span class="n">FaultDsc</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">DurationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">E_EquipmentFailureInfo_Pro</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">BBdbR_DvcBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">DvcCd</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">DvcCd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">isFile</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">DurationTime</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">FaultDsc</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">DvcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--验证
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">DvcNm</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">E_EquipmentFailureInfo_Pro</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">BBdbR_DvcBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">DvcCd</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">DvcCd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">isFile</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">DvcNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--SQL 2.0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="err">${</span><span class="n">textEditortopN</span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FaultDsc</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">DurationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">E_EquipmentFailureInfo_Pro</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">isFile</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">DurationTime</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxPlineNm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PlineNm</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxPlineNm}%&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxCarType}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxCarType}%&#39;</span><span class="p">)</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">FaultDsc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">分</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><h3 id="4设备报警记录次数top-n">4.设备报警记录次数Top &rsquo;n'</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 设备报警次数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="err">${</span><span class="n">textEditortopN</span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">DvcCd</span><span class="p">,</span><span class="n">FaultDsc</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">次数</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">E_EquipmentFailureInfo_File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">FaultRecTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">FaultRecTime</span><span class="w"> </span><span class="o">&lt;=</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxDvcCd}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">DvcCd</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxDvcCd}%&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DvcCd</span><span class="p">,</span><span class="n">FaultDsc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">次数</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><h3 id="5车身工艺参数查询">5.车身工艺参数查询</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- WcNm
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">WcNm</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">BBdbR_WcBase</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">   </span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 记录 
</span></span></span><span class="line"><span class="cl"><span class="c1">--实现参数框联动
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">P_CarProcessParametersRecord</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">  </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">[</span><span class="n">Enabled</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">GetItemTm</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="s1">&#39;${StartTm}&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="s1">&#39;${EndTm}&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">BodyNo</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;%${BodyNo}%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="s1">&#39;${BodyNo}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">GetItemNm</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;%${GetItemNm}%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="s1">&#39;${GetItemNm}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">WcNm</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;%${WcNm}%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="s1">&#39;${WcNm}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">GetItemTm</span><span class="p">]</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span></code></pre></div><h2 id="能源报表">能源报表</h2>
<h3 id="6工况累计流量-比例分析">6.工况累计流量-比例分析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--参考 电度-比例分析
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">   </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">EnergyProp</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">EnergyVal</span><span class="o">/</span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">EnergyVal</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w">  </span><span class="p">[</span><span class="n">P_EquipmentEnergyConsumptionRecord</span><span class="p">]</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">EnergyNm</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;工况累计流量&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">E_EnergyConfig</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">Class</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">EnergyVal</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EnergyVal</span><span class="w"> </span><span class="k">FROM</span><span class="w">  </span><span class="p">[</span><span class="n">P_EquipmentEnergyConsumptionRecord</span><span class="p">]</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">EnergyNm</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;工况累计流量&#39;</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">Class</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="k">Class</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">Class</span><span class="w">
</span></span></span></code></pre></div><h3 id="7工况累计流量-趋势分析">7.工况累计流量-趋势分析</h3>
<h3 id="8气-比例分析">8.气-比例分析</h3>
<h3 id="9气-趋势分析">9.气-趋势分析</h3>
<h2 id="能源">能源</h2>
<ul>
<li>
<p>一个表格：管控区域，管控区域分配的能源比例，管控区域实际的能源比例</p>
</li>
<li>
<p>一个折线图：按照选择的管控区域展示一个月的电度趋势</p>
<p><figure 
	>
	<a href="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549372222.png" >
		<img src="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549372222.png"
			
			
			
			loading="lazy"
			alt="1662549372222">
	</a>
	
	<figcaption>1662549372222</figcaption>
	
</figure></p>
</li>
</ul>
<p>查出来这个表的Class和EnergyProp</p>
<p><figure 
	>
	<a href="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549409182.png" >
		<img src="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549409182.png"
			
			
			
			loading="lazy"
			alt="1662549409182">
	</a>
	
	<figcaption>1662549409182</figcaption>
	
</figure></p>
<p>联合查询这个表条件是Class相同</p>
<p><figure 
	>
	<a href="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549449290.png" >
		<img src="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549449290.png"
			
			
			
			loading="lazy"
			alt="1662549449290">
	</a>
	
	<figcaption>1662549449290</figcaption>
	
</figure></p>
<p>查这个表的时候要把Class相同的总有功电度加起来，再除以所有的总有功电度的和，</p>
<p><figure 
	>
	<a href="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549517209.png" >
		<img src="/D:%5cTypora%5c%e7%ac%94%e8%ae%b0%5c%e5%b8%86%e8%bd%af%e6%8a%a5%e8%a1%a8%e7%9b%b8%e5%85%b3%5cZ--%e6%b6%82%e8%a3%85FAS%e6%8a%a5%e8%a1%a8.assets%5c1662549517209.png"
			
			
			
			loading="lazy"
			alt="1662549517209">
	</a>
	
	<figcaption>1662549517209</figcaption>
	
</figure></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">---电度趋势图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">every_time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">日期</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">Class</span><span class="p">,</span><span class="s1">&#39;${Class}&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">管控区域区域</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="n">EnergyVal</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">电度</span><span class="w"> </span><span class="k">FROM</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CONVERT</span><span class="w"> </span><span class="p">(</span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="n">dateadd</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="nb">number</span><span class="p">,</span><span class="w"> </span><span class="n">dateadd</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="o">-</span><span class="k">day</span><span class="p">(</span><span class="n">getdate</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">getdate</span><span class="p">())),</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">every_time</span><span class="w"> </span><span class="c1">--日期
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">master</span><span class="p">..</span><span class="n">spt_values</span><span class="w"> </span><span class="n">n</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">n</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;p&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="nb">number</span><span class="o">&lt;</span><span class="n">datediff</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="n">dateadd</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="o">-</span><span class="k">day</span><span class="p">(</span><span class="n">getdate</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">getdate</span><span class="p">()),</span><span class="n">dateadd</span><span class="p">(</span><span class="n">mm</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dateadd</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="o">-</span><span class="k">day</span><span class="p">(</span><span class="n">getdate</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">getdate</span><span class="p">())))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="n">R</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">EnergyVal</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="k">as</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">P_EquipmentEnergyConsumptionRecord_File</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">E_EnergyConfig</span><span class="w"> </span><span class="n">b</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="k">Class</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">WHERE</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${Class}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${Class}%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">EnergyNm</span><span class="o">=</span><span class="s1">&#39;总有功电度&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">DateName</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">))</span><span class="o">=</span><span class="mi">20</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">DateName</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">))</span><span class="o">=</span><span class="mi">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">AND</span><span class="w"> </span><span class="k">Day</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">Day</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="p">,</span><span class="n">EnergyVal</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="n">TAB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">TAB</span><span class="p">.</span><span class="n">t</span><span class="o">=</span><span class="n">R</span><span class="p">.</span><span class="n">every_time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">every_time</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="err">一个表格：管控区域，管控区域分配的能源比例，管控区域实际的能源比例</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">EnergyProp</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">EnergyVal</span><span class="o">/</span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">EnergyVal</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w">  </span><span class="p">[</span><span class="n">P_EquipmentEnergyConsumptionRecord</span><span class="p">]</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">EnergyNm</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;总有功电度&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">E_EnergyConfig</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">Class</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">EnergyVal</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EnergyVal</span><span class="w"> </span><span class="k">FROM</span><span class="w">  </span><span class="p">[</span><span class="n">P_EquipmentEnergyConsumptionRecord</span><span class="p">]</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">EnergyNm</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;总有功电度&#39;</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">Class</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">Class</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="k">Class</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">Class</span><span class="w">
</span></span></span></code></pre></div><h3 id="生产报表">生产报表</h3>
<h3 id="jph">JPH</h3>
<ul>
<li>
<p>注释时间
去重？是站点去重嘛？
不是有过点信息就展示 需要展示所有的站点信息 没有过点信息的展示为0 ab点只取一个点</p>
</li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--Jph为当天的平均每小时产量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">AviNm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">BodyNo</span><span class="p">)</span><span class="err">过点数量</span><span class="p">,</span><span class="err">时间</span><span class="o">=</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">datediff</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="n">PastTime</span><span class="p">,</span><span class="s1">&#39;2022-05-15&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">AviNm</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--时间筛查
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="err">时间</span><span class="o">=</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">datediff</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="n">PastTime</span><span class="p">,</span><span class="s1">&#39;2022-05-15&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--时间筛查2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="err">时间</span><span class="o">=</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">PastTime</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">AviNm</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_AVIBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_638&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_636&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_619&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_621&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_606&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_610&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_602&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_614&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_641&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_605&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_655&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_644&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_645&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_646&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_647&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_648&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_649&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_650&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--尝试1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">BodyNo</span><span class="p">)</span><span class="err">过点数量</span><span class="p">,</span><span class="err">时间</span><span class="o">=</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_AVIBase</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">AviId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_638&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_636&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_619&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_621&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_606&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_610&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_602&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_614&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_641&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_605&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_655&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_644&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_645&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_646&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_647&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_648&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_649&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_650&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">PastTime</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="n">PastTime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--尝试2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">BodyNo</span><span class="p">)</span><span class="err">过点数量</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_AVIBase</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">AviId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_638&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_636&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_619&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_621&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_606&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_610&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_602&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_614&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_641&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_605&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_655&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_644&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_645&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_646&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_647&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_648&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_649&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_650&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--尝试3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="n">BodyNo</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="err">过点数量</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_AVIBase</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">AviId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">PastTime</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_638&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_636&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_619&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_621&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_606&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_610&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_602&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_614&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_641&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_605&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_655&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_644&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_645&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_646&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_647&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_648&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_649&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_650&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--尝试4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="err">时间</span><span class="o">=</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_AVIBase</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">AviId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_638&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_636&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_619&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_621&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_606&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_610&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_602&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_614&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_641&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_605&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_655&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_644&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_645&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_646&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_647&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_648&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_649&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_650&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="n">PastTime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--尝试5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="err">过点数量</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="err">过点数量</span><span class="w"> </span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_AVIBase</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">AviId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_638&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_636&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_619&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_621&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_606&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_610&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_602&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_614&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_641&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_605&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_655&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_644&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_645&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_646&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_647&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_648&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_649&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_650&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="n">BodyNo</span><span class="p">)</span><span class="err">过点数量</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_AVIBase</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">AviId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">PastTime</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;2022-05-15 08:00:00&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_638&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_636&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_619&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_621&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_606&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;AVI_610&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_602&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_614&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_641&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_605&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_655&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_644&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_645&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_646&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_647&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_648&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_649&#39;</span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviCd</span><span class="o">!=</span><span class="s1">&#39;AVI_650&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">AviNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">T</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">A</span><span class="p">.</span><span class="n">AviNm</span><span class="o">=</span><span class="n">T</span><span class="p">.</span><span class="n">AviNm</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
<h3 id="生产日报">生产日报</h3>
<ul>
<li>
<p>八点0000000到第二天七点59.59.59</p>
</li>
<li>
<p>说明也要加 算法也加
不要车型选择控件 按照日期查询展示所有车型
实际上下线不在一列</p>
</li>
<li>
<p>年月日三张报表</p>
<h2 id="生产月报20">生产月报2.0</h2>
</li>
<li>
<p>SQL语句1</p>
</li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="n">JAC_PaintingFAS</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/****** Object:  UserDefinedFunction [dbo].[produceYear]    Script Date: 2022/6/22 15:41:54 ******/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">ANSI_NULLS</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">QUOTED_IDENTIFIER</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">produceYear</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">SearchYear</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="o">@</span><span class="n">AviCd</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURNS</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="k">Table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">indexrow</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">CarType</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="n">Num</span><span class="w"> </span><span class="nb">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="w"> </span><span class="n">datetime</span><span class="o">=</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">@</span><span class="n">SearchYear</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-01-01 00:00:00.000&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w">	</span><span class="o">@</span><span class="n">DATE_ENDadd</span><span class="w"> </span><span class="n">datetime</span><span class="o">=</span><span class="n">dateadd</span><span class="w"> </span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="o">@</span><span class="n">DATE_START</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w">	</span><span class="o">@</span><span class="n">DATE_END</span><span class="w"> </span><span class="n">datetime</span><span class="o">=</span><span class="n">dateadd</span><span class="w"> </span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="o">@</span><span class="n">DATE_ENDadd</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">DateInfo</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w">			
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w"> </span><span class="k">table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">indexrow</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">CarType</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="n">Num</span><span class="w"> </span><span class="nb">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">		
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">[</span><span class="n">AviCd</span><span class="p">]</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">CarType</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">[</span><span class="n">PastTime</span><span class="p">]</span><span class="w"> </span><span class="n">datetime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w">  </span><span class="c1">--每月X
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">		</span><span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">char</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="n">DATEADD</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="nb">number</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="p">),</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DATA_DATE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">FROM</span><span class="w">    </span><span class="n">master</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">spt_values</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="n">spt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">WHERE</span><span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;p&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_END</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> </span><span class="p">[</span><span class="n">AviCd</span><span class="p">],</span><span class="n">CarType</span><span class="p">,[</span><span class="n">PastTime</span><span class="p">]</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w">		
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">where</span><span class="w"> </span><span class="p">[</span><span class="n">PastTime</span><span class="p">]</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="n">CarType</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">[</span><span class="n">AviCd</span><span class="p">]</span><span class="o">=@</span><span class="n">AviCd</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="c1">--声明一个游标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">		</span><span class="k">declare</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">DateInfo</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		 </span><span class="c1">--打开游标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">			</span><span class="k">open</span><span class="w"> </span><span class="n">dy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="c1">--提取游标1第一行内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">			</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="c1">--循环提取游标1内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">			</span><span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">col</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="c1">--每天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">					</span><span class="o">@</span><span class="k">IsNull</span><span class="w">	</span><span class="nb">int</span><span class="w">				
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateInfo</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">DateInfo</span><span class="o">=@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="k">IsNull</span><span class="o">=</span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">indexrow</span><span class="o">=@</span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="k">IsNull</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">begin</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="p">(</span><span class="n">indexrow</span><span class="p">,</span><span class="n">CarType</span><span class="p">,</span><span class="n">Num</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">col</span><span class="p">,</span><span class="k">null</span><span class="p">,</span><span class="k">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">begin</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">indexrow</span><span class="o">=@</span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">CLOSE</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="c1">--关闭游标 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="c1">--释放游标资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">RETURN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>SQL语句1.1</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="n">JAC_PaintingFAS</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/****** Object:  UserDefinedFunction [dbo].[produceYear]    Script Date: 2022/6/22 15:54:11 ******/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">ANSI_NULLS</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">QUOTED_IDENTIFIER</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">produceYear</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">SearchYear</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURNS</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="k">Table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">indexrow</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">CarType</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="n">Num</span><span class="w"> </span><span class="nb">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="w"> </span><span class="n">datetime</span><span class="o">=</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">@</span><span class="n">SearchYear</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-01-01 00:00:00.000&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w">	</span><span class="o">@</span><span class="n">DATE_ENDadd</span><span class="w"> </span><span class="n">datetime</span><span class="o">=</span><span class="n">dateadd</span><span class="w"> </span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="o">@</span><span class="n">DATE_START</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w">	</span><span class="o">@</span><span class="n">DATE_END</span><span class="w"> </span><span class="n">datetime</span><span class="o">=</span><span class="n">dateadd</span><span class="w"> </span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="o">@</span><span class="n">DATE_ENDadd</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">DateInfo</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w">			
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w"> </span><span class="k">table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">indexrow</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">CarType</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="n">Num</span><span class="w"> </span><span class="nb">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">		 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">CarType</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">[</span><span class="n">PastTime</span><span class="p">]</span><span class="w"> </span><span class="n">datetime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w">  </span><span class="c1">--每月X
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">		</span><span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">char</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="w"> </span><span class="n">DATEADD</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="nb">number</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="p">),</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DATA_DATE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">FROM</span><span class="w">    </span><span class="n">master</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">spt_values</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="n">spt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">WHERE</span><span class="w">   </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;p&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_END</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> </span><span class="n">CarType</span><span class="p">,[</span><span class="n">PastTime</span><span class="p">]</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w">		
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">where</span><span class="w"> </span><span class="p">[</span><span class="n">PastTime</span><span class="p">]</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_START</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">@</span><span class="n">DATE_END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="n">CarType</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="c1">--声明一个游标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">		</span><span class="k">declare</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">DateInfo</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		 </span><span class="c1">--打开游标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">			</span><span class="k">open</span><span class="w"> </span><span class="n">dy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="c1">--提取游标1第一行内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">			</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="c1">--循环提取游标1内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">			</span><span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">col</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="c1">--每天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">					</span><span class="o">@</span><span class="k">IsNull</span><span class="w">	</span><span class="nb">int</span><span class="w">				
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateInfo</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">IndexTable</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">DateInfo</span><span class="o">=@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="k">IsNull</span><span class="o">=</span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">indexrow</span><span class="o">=@</span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="k">IsNull</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">begin</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="p">(</span><span class="n">indexrow</span><span class="p">,</span><span class="n">CarType</span><span class="p">,</span><span class="n">Num</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">col</span><span class="p">,</span><span class="k">null</span><span class="p">,</span><span class="k">null</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">begin</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">BeforeData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">indexrow</span><span class="o">=@</span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">CLOSE</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="c1">--关闭游标 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="c1">--释放游标资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">RETURN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>SQL语句&ndash;datachart</p>
</li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;01-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;02-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;03-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;04-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;05-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;06-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;07-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;08-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;09-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;10-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;11-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">daycol</span><span class="p">))</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;12-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--from fineReportDailyTable(&#39;${searchDate}&#39;) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">cartype</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>SQL语句</p>
</li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="err">实际上线</span><span class="p">)</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">sum</span><span class="p">(</span><span class="err">实际下线</span><span class="p">)</span><span class="w"> </span><span class="err">实际下线</span><span class="w"> </span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">daycol</span><span class="w"> </span><span class="err">月份</span><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;01-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;01-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;02-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;02-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;03-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;03-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;04-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;04-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;05-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;05-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;06-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;06-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;07-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;07-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;08-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;08-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;09-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;09-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;10-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;10-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;11-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;11-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">onlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际上线</span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">offlinenum</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="err">实际下线</span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;12-01&#39;</span><span class="p">,</span><span class="mi">120</span><span class="p">)))</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;12-01&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">daycol</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">daycol</span><span class="w"> </span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div></li>
<li></li>
</ul>
<h2 id="质量报表">质量报表</h2>
<h3 id="ftt">FTT</h3>
<ul>
<li>说明：计算FTT公式：（总数量-不合格数量）/总数据。其中总数量为这一段时间内过点车辆，且在这段时间之前没有过点，如果车辆过了两次或两次以上只算1次，且取的是第一次过点的数据。不合格数据为这段时间内，过点车辆但是任然有未修复的缺陷+过点车辆缺陷也已经修复但是是在下线（下线AVI站点，对于没有下线AVI站点的取的是上线AVI站点）之后修复的。</li>
</ul>
<h3 id="dpu">DPU</h3>
<ul>
<li>DPU计算公试：缺陷总数/车辆总数。缺陷总数为这段时间内该线体发生的缺陷总合。车辆总数为这段时间内第一次经过该线体AVI站点的车辆，同一辆车重复或多次多点只算一次。</li>
</ul>
<h1 id="生产报表-1">生产报表</h1>
<h2 id="sql语句">SQL语句</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--建表语句
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="n">JAC_PaintingFAS</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/****** Object:  UserDefinedFunction [dbo].[fineReportDailyTable]    Script Date: 2022/5/18 9:30:20 ******/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">ANSI_NULLS</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">QUOTED_IDENTIFIER</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">fineReportDailyTable</span><span class="p">]</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">searchDate</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURNS</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="k">Table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">rowindex</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="n">daycol</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="n">cartype</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">plannum</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="n">onlinenum</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="n">offlinenum</span><span class="w"> </span><span class="nb">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--声明表变量临时存储
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">cartype</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="c1">--车型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">planonline</span><span class="w"> </span><span class="nb">int</span><span class="c1">--计划上线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">actonline</span><span class="w"> </span><span class="nb">int</span><span class="c1">--实际上线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">actoffline</span><span class="w"> </span><span class="nb">int</span><span class="c1">--实际下线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">dayData</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">daycol</span><span class="w"> </span><span class="n">datetime</span><span class="c1">--月中的每天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">		</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">cartyp</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="c1">--车型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">		</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">dayData</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="o">@</span><span class="n">searchDate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nb">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">datetime</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">daycol</span><span class="w"> </span><span class="k">from</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">master</span><span class="p">..</span><span class="n">spt_values</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="nb">number</span><span class="p">,</span><span class="k">cast</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="o">@</span><span class="n">searchDate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-01&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">datetime</span><span class="p">))</span><span class="o">&lt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="k">cast</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="o">@</span><span class="n">searchDate</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-01&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">datetime</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">left</span><span class="p">(</span><span class="n">CarType</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cartyp</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">PastTime</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">searchDate</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">left</span><span class="p">(</span><span class="n">CarType</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="c1">--序号建立
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--声明一个游标1,2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">daycol</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">dayData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">cartyp</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">--打开游标1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">open</span><span class="w"> </span><span class="n">dy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--提取游标1第一行内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w"> </span><span class="n">datetime</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--循环提取游标1内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">col</span><span class="w"> </span><span class="n">datetime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">daycol</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">dayData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">daycol</span><span class="o">=@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--打开游标2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">open</span><span class="w"> </span><span class="n">car</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--提取游标2第一行内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--循环提取游标2内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="k">begin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">cartype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cartyp</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">cartyp</span><span class="o">=@</span><span class="n">cartyp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="n">planonline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_ProducePlan_Pro</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PlanTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="o">@</span><span class="n">col</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="k">and</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="n">actonline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="o">@</span><span class="n">col</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="k">and</span><span class="w"> </span><span class="n">AviCd</span><span class="o">=</span><span class="s1">&#39;AVI_601&#39;</span><span class="p">)</span><span class="w">	 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="n">actoffline</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="o">@</span><span class="n">col</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="k">and</span><span class="w"> </span><span class="n">AviCd</span><span class="o">=</span><span class="s1">&#39;AVI_655&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="p">(</span><span class="n">rowindex</span><span class="p">,</span><span class="n">daycol</span><span class="p">,</span><span class="n">cartype</span><span class="p">,</span><span class="n">plannum</span><span class="p">,</span><span class="n">onlinenum</span><span class="p">,</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="k">index</span><span class="p">,</span><span class="o">@</span><span class="n">col</span><span class="p">,</span><span class="o">@</span><span class="n">cartype</span><span class="p">,</span><span class="o">@</span><span class="n">planonline</span><span class="p">,</span><span class="o">@</span><span class="n">actonline</span><span class="p">,</span><span class="o">@</span><span class="n">actoffline</span><span class="p">)</span><span class="w">	  	   
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="k">CLOSE</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="c1">--关闭游标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	  </span><span class="c1">--DEALLOCATE car  --释放游标资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	  </span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="o">+</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">daycol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">END</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CLOSE</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="c1">--关闭游标 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="c1">--释放游标资源	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">car</span><span class="w">  </span><span class="c1">--释放游标资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">RETURN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--有误-月报多语句建表函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="n">JAC_PaintingFAS</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/****** Object:  UserDefinedFunction [dbo].[fineReportDailyTable]    Script Date: 2022/5/18 9:50:33 ******/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">ANSI_NULLS</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">QUOTED_IDENTIFIER</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">fineReportMonthTable</span><span class="p">]</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">searchDate</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURNS</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="k">Table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">rowindex</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="p">,</span><span class="n">cartype</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">plannum</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="n">onlinenum</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="n">offlinenum</span><span class="w"> </span><span class="nb">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--声明表变量临时存储
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">cartype</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="c1">--车型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">planonline</span><span class="w"> </span><span class="nb">int</span><span class="c1">--计划上线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">actonline</span><span class="w"> </span><span class="nb">int</span><span class="c1">--实际上线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">actoffline</span><span class="w"> </span><span class="nb">int</span><span class="c1">--实际下线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="n">cartyp</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="c1">--车型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">		</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">left</span><span class="p">(</span><span class="n">CarType</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cartyp</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">PastTime</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">searchDate</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">left</span><span class="p">(</span><span class="n">CarType</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="c1">--序号建立
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--声明一个游标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">cartyp</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--打开游标2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">open</span><span class="w"> </span><span class="n">car</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--提取游标2第一行内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">--循环提取游标2内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="k">begin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">cartype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cartyp</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">CarTpData</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">cartyp</span><span class="o">=@</span><span class="n">cartyp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="n">planonline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_ProducePlan_Pro</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PlanTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PlanTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="n">actonline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="k">and</span><span class="w"> </span><span class="n">AviCd</span><span class="o">=</span><span class="s1">&#39;AVI_601&#39;</span><span class="p">)</span><span class="w">	 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="n">actoffline</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastRecordInfo</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">PastTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="k">and</span><span class="w"> </span><span class="n">AviCd</span><span class="o">=</span><span class="s1">&#39;AVI_655&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="p">(</span><span class="n">rowindex</span><span class="p">,</span><span class="n">cartype</span><span class="p">,</span><span class="n">plannum</span><span class="p">,</span><span class="n">onlinenum</span><span class="p">,</span><span class="n">offlinenum</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="k">index</span><span class="p">,</span><span class="o">@</span><span class="n">cartype</span><span class="p">,</span><span class="o">@</span><span class="n">planonline</span><span class="p">,</span><span class="o">@</span><span class="n">actonline</span><span class="p">,</span><span class="o">@</span><span class="n">actoffline</span><span class="p">)</span><span class="w">	  	   
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">fetch</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">cartyp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="k">CLOSE</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="c1">--关闭游标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	  </span><span class="c1">--DEALLOCATE car  --释放游标资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	  </span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="k">index</span><span class="o">+</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">car</span><span class="w">  </span><span class="c1">--释放游标资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">RETURN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span></code></pre></div><p>问题点：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="s1">&#39;2022-05-04&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">fineReportDailyTable</span><span class="p">(</span><span class="s1">&#39;${searchDate}&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span></code></pre></div><p>sql语句：多语句建表函数为什么select * 是按照车型（加空白共六种车型）分组 共31组 这个数据就很奇怪；</p>
<p>select sum 也就是不太对了</p>
<h1 id="质量报表-1">质量报表</h1>
<h2 id="数据查询">数据查询</h2>
<ul>
<li>
<p>一些摘抄：</p>
<p>需得做好该做的从中获取价值意义 然后再去心安理得的去做无意义又愉悦身心的事 才叫闲暇</p>
<p>相反 如果闲暇是建立在摒弃一切有价值有意义的事物躺下 则全然不觉得愉快</p>
</li>
<li>
<p>车身质量检查过程表：所有过检车辆的信息记录&mdash;过检车辆总数</p>
</li>
<li>
<p>车身部位质检缺陷过程表：过检后出现问题的车辆具体缺陷信息&mdash;缺陷问题数</p>
</li>
<li>
<p>车身质量检查销项过程表：有问题车辆的修理数据记录</p>
</li>
<li>
<p>缺陷问题点分类表：将检查到的缺陷问题按照固定类别进行分类</p>
</li>
</ul>
<h2 id="联合查询-字段对应">联合查询 字段对应</h2>
<ul>
<li>1.产线基础信息表：产线主键&ndash;PlineId；产线名称&ndash;PlineNm</li>
<li>2.工位基础信息表：产线主键&ndash;PlineId；工位主键&ndash;WcId</li>
<li>3.车身质量过程表：质控点主键&ndash;WcId</li>
<li>4.车身部位质检缺陷过程表：质控点主键&ndash;WcId；：缺陷主键&ndash;DefectId</li>
<li>5.缺陷问题点分类表：缺陷主键&ndash;DefectId</li>
</ul>
<h2 id="逻辑分析">逻辑分析</h2>
<h3 id="质量top分类dpu">质量TOP分类DPU</h3>
<ul>
<li>
<p>数据集要求：</p>
<p>产线-缺陷数量-车型-创建时间-缺陷名称-过检车辆数目</p>
</li>
<li>
<p>SQL语句：</p>
<p>多表联合查询：缺陷数量联合查询；</p>
<p>过检车辆数联合查询</p>
</li>
</ul>
<h3 id="单点问题趋势">单点问题趋势</h3>
<ul>
<li>
<p>数据处理问题点</p>
<p>没有统计车身质量检查过程表数据，只联合车身部位质检缺陷过程表、产线基础信息表、工位基础信息表三表查询。过点车辆数为count(CarType)、当日缺陷数为count(DefectId)且Enabled=&lsquo;1&rsquo;</p>
</li>
</ul>
<h2 id="sql语句存档">SQL语句存档</h2>
<h3 id="质量top分类dpu及单点问题趋势">质量TOP分类DPU及单点问题趋势</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--缺陷数量及过检车辆数（无关产线、时间、车型）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">BodyNo</span><span class="p">)</span><span class="err">当日过检车辆总数</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">DefectId</span><span class="p">)</span><span class="err">当日缺陷总数</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--当日过检车辆总数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">BodyNo</span><span class="p">)</span><span class="err">当日过检车辆总数</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">---缺陷数量联合查询
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">DefectId</span><span class="p">)</span><span class="err">当日缺陷数量</span><span class="p">,</span><span class="n">y</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">y</span><span class="p">.</span><span class="n">CarType</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w"> </span><span class="n">x</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">y</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">y</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">z</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">w</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">z</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="n">w</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">y</span><span class="p">.</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">---过检车辆联合查询
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">BodyNo</span><span class="p">)</span><span class="err">当日过检车辆总数</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">CarType</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w"> </span><span class="n">d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">f</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="k">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="k">g</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w">  </span><span class="n">d</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--合并1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">DefectId</span><span class="p">)</span><span class="err">当日缺陷数量</span><span class="p">,</span><span class="n">y</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">y</span><span class="p">.</span><span class="n">CarType</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">BodyNo</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w"> </span><span class="n">d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">f</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="k">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="k">g</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w">  </span><span class="n">d</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">PlineNm</span><span class="o">=</span><span class="n">w</span><span class="p">.</span><span class="n">PlineNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DefectNm</span><span class="o">=</span><span class="n">y</span><span class="p">.</span><span class="n">DefectNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">CreTm</span><span class="o">=</span><span class="n">y</span><span class="p">.</span><span class="n">CreTm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CarType</span><span class="o">=</span><span class="n">y</span><span class="p">.</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">CarType</span><span class="p">)</span><span class="err">当日过检车辆总数</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w"> </span><span class="n">x</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">y</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">y</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">z</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">w</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">z</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="n">w</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">y</span><span class="p">.</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">---合并2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">DefectId</span><span class="p">)</span><span class="err">当日缺陷数量</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CarType</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">BodyNo</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w"> </span><span class="n">d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">f</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="k">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="k">g</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w">  </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="k">g</span><span class="p">.</span><span class="n">PlineNm</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">PlineNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DefectNm</span><span class="o">=</span><span class="n">a</span><span class="p">.</span><span class="n">DefectNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">CreTm</span><span class="o">=</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">CarType</span><span class="p">)</span><span class="err">当日过检车辆总数</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CarType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">---一些数据筛选
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">CreTm</span><span class="o">=</span><span class="s1">&#39;2021-12-31 15:08:58.630&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;8e7d9e9d-4e4d-4150-a5d7-24001e87d624&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">CreTm</span><span class="o">=</span><span class="s1">&#39;2021-12-31 15:08:58.630&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;8e7d9e9d-4e4d-4150-a5d7-24001e87d624&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">---筛选12.31的划伤数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">CreTm</span><span class="o">=</span><span class="s1">&#39;2021-12-31 15:08:58.630&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">DefectNm</span><span class="o">=</span><span class="s1">&#39;划伤&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;7a7a468e-e25a-4f89-b462-957aa7b2a71&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">CreTm</span><span class="o">=</span><span class="s1">&#39;2021-12-31 15:08:58.630&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;7a7a468e-e25a-4f89-b462-957aa7b2a71&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;7a7a468e-e25a-4f89-b462-957aa7b2a71&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">PlineId</span><span class="o">=</span><span class="s1">&#39;30a5209d-d850-4156-841b-684465b518658&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">  </span><span class="n">PlineId</span><span class="o">=</span><span class="s1">&#39;30a5209d-d850-4156-841b-684465b518658&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--筛选2021-1-05、2021-11-28凹陷数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">CreTm</span><span class="o">=</span><span class="s1">&#39;2021-01-05 09:09:11.087&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">DefectNm</span><span class="o">=</span><span class="s1">&#39;凹&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;d66bfaec-4328-4802-aa6e-c1b49cf676ca&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarQualityInspection_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">CreTm</span><span class="o">=</span><span class="s1">&#39;2021-01-05 09:09:11.087&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;d66bfaec-4328-4802-aa6e-c1b49cf676ca&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">WcId</span><span class="o">=</span><span class="s1">&#39;d66bfaec-4328-4802-aa6e-c1b49cf676ca&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">PlineId</span><span class="o">=</span><span class="s1">&#39;59a51f72-55b0-4a02-b713-4e9281f9f6919&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">  </span><span class="n">PlineId</span><span class="o">=</span><span class="s1">&#39;59a51f72-55b0-4a02-b713-4e9281f9f6919&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">---如果Enabled无效则数据为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">else</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">Enabled</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Enabled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">Enabled</span><span class="p">)</span><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span></code></pre></div><h2 id="质量问题分类">质量问题分类</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">CarType</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">DefectIssuesTypeNm</span><span class="p">,</span><span class="n">Dsc</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">Dsc</span><span class="p">)</span><span class="err">缺陷数</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">BBdbR_DefectIssuesType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">DefectIssuesTypeNm</span><span class="p">,</span><span class="n">Dsc</span><span class="w">
</span></span></span></code></pre></div><h2 id="单点问题趋势-1">单点问题趋势</h2>
<h3 id="样式表">样式表</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">CarType</span><span class="p">)</span><span class="err">当日过点车数量</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CarType</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">DefectId</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="w"> </span><span class="o">&gt;=</span><span class="s1">&#39;${startTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="w"> </span><span class="o">&lt;=</span><span class="s1">&#39;${endTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxMatter}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">DefectNm</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxMatter}%&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxCarType}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxCarType}%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">PlineNm</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">PlineNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">DefectNm</span><span class="o">=</span><span class="n">a</span><span class="p">.</span><span class="n">DefectNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="o">=</span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CarType</span><span class="p">)</span><span class="err">当日问题总数</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w"> </span><span class="n">d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_WcBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">WcId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">WcId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">PlineId</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">PlineId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="w"> </span><span class="o">&gt;=</span><span class="s1">&#39;${startTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="w"> </span><span class="o">&lt;=</span><span class="s1">&#39;${endTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxMatter}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">DefectNm</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxMatter}%&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${comboBoxCarType}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CarType</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${comboBoxCarType}%&#39;</span><span class="p">)</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">CreTm</span><span class="p">,</span><span class="n">PlineNm</span><span class="p">,</span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CarType</span><span class="w">
</span></span></span></code></pre></div><h2 id="9按时段质量问题对比分析查重">9.按时段质量问题对比分析、查重</h2>
<h3 id="要求">要求</h3>
<p>根据时间段搜索质量问题的对比以及分析，并且可以根据相似的问题找到该问题以前出现的时间段。</p>
<h3 id="逻辑">逻辑</h3>
<p>饼状图 ；</p>
<p>按照时间按查询；</p>
<p>展示缺陷占比（某缺陷数量/总缺陷数量）；</p>
<p>点击饼状图问题区域，链接跳转到该问题明细表-展示出现该问题的所有时间段、车型等信息</p>
<h3 id="sql语句-1">SQL语句</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">DefectNm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">DefectNm</span><span class="p">)</span><span class="err">缺陷数量</span><span class="p">,</span><span class="n">CreTm</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CreTm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--数据集语句
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">比例：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">DefectNm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">DefectNm</span><span class="p">)</span><span class="err">缺陷数量</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CreTm</span><span class="w"> </span><span class="o">&gt;=</span><span class="s1">&#39;${startTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CreTm</span><span class="w"> </span><span class="o">&lt;=</span><span class="s1">&#39;${endTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">DefectNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">时间段：</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CreTm</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CreTm</span><span class="w"> </span><span class="o">&gt;=</span><span class="s1">&#39;${startTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">CreTm</span><span class="w"> </span><span class="o">&lt;=</span><span class="s1">&#39;${endTm} 00:00:00.000&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">DefectNm</span><span class="p">,</span><span class="n">CreTm</span><span class="w">
</span></span></span></code></pre></div><h2 id="sql笔记">SQL笔记</h2>
<h3 id="如果enabled无效则数据为0">如果Enabled无效则数据为0</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">---如果Enabled无效则数据为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">else</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">Enabled</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">Q_CarPartQualityInspectionDefect_Pro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Enabled</span><span class="w">
</span></span></span></code></pre></div><h2 id="6车身所有过程质量问题查询-质量明细无代码问题录入统计">6.车身所有过程质量问题查询, 质量明细、无代码问题录入统计</h2>
<h3 id="建表思路">建表思路</h3>
<p>图表为甘特图</p>
<h1 id="设备报表">设备报表</h1>
<h2 id="1avi车身过点信息追溯及查询">1.AVI车身过点信息追溯及查询</h2>
<h3 id="sql查询语句">SQL查询语句</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">PastTime</span><span class="p">,</span><span class="n">AviNm</span><span class="p">,</span><span class="n">PastNo</span><span class="p">,</span><span class="n">OrderCd</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">BodyNo</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">CarType</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">VIN</span><span class="p">,</span><span class="n">AviCd</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">P_CarPastInfo_Pro</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">P_ProducePlan_Pro</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">ProducePlanCd</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">ProducePlanCd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">AviCd</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%AVI%&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">PastTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="s1">&#39;${startTm}&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">PastTime</span><span class="w"> </span><span class="o">&lt;=</span><span class="s1">&#39;${endTm}&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${bodyno}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">BodyNo</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${bodyno}%&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="s1">&#39;${avicd}&#39;</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">AviNm</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%${avicd}%&#39;</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">Enabled</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="err">${</span><span class="n">sort</span><span class="err">}</span><span class="w"> </span><span class="err">${</span><span class="n">sortstyle</span><span class="err">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="2设备报警信息文本显示及优先级分类">2.设备报警信息文本显示及优先级分类</h2>
<h3 id="sql查询语句-1">SQL查询语句</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--新建多语句表值函数：
</span></span></span><span class="line"><span class="cl"><span class="c1">--月
</span></span></span><span class="line"><span class="cl"><span class="c1">--[dbo].[DvcTypeDay]：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="n">JAC_PaintingFAS</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/****** Object:  UserDefinedFunction [dbo].[DvcTypeDay]    Script Date: 2022/4/18 11:01:36 ******/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">ANSI_NULLS</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">QUOTED_IDENTIFIER</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">DvcTypeDay</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">StartTm</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">EndTm</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">PlineNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURNS</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="k">Table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">indexrow</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="n">DvcNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">SumTm</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span><span class="n">StopNum</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">FaultStartTime</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">DurationTime</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">DvcNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">PlineNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> </span><span class="n">FaultStartTime</span><span class="p">,</span><span class="n">DurationTime</span><span class="p">,</span><span class="n">DvcNm</span><span class="p">,</span><span class="n">PlineNm</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">[</span><span class="n">E_EquipmentFailureInfo_Pro</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">WorkSectionId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">WorkSectionId</span><span class="w">		
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">where</span><span class="w"> </span><span class="n">FaultStartTime</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="o">@</span><span class="n">StartTm</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">@</span><span class="n">EndTm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="o">=@</span><span class="n">PlineNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> 	</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">FaultStartTime</span><span class="p">,</span><span class="mi">120</span><span class="p">),</span><span class="n">DvcNm</span><span class="p">,</span><span class="k">Sum</span><span class="p">(</span><span class="n">DurationTime</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="w"> </span><span class="n">SumTm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">StopNum</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">DvcNm</span><span class="p">,</span><span class="k">convert</span><span class="p">(</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">FaultStartTime</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span><span class="w">		 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">RETURN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--新建多语句表值函数：
</span></span></span><span class="line"><span class="cl"><span class="c1">--周
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="n">JAC_PaintingFAS</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/****** Object:  UserDefinedFunction [dbo].[DvcTypeWeek]    Script Date: 2022/4/19 15:58:50 ******/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">ANSI_NULLS</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">QUOTED_IDENTIFIER</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">DvcTypeWeek</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">StartTm</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">EndTm</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">@</span><span class="n">PlineNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURNS</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">@</span><span class="k">Data</span><span class="w"> </span><span class="k">Table</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	 </span><span class="n">indexrow</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">DvcNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">SumTm</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span><span class="n">StopNum</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">FaultStartTime</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">DurationTime</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">DvcNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">PlineNm</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> </span><span class="n">FaultStartTime</span><span class="p">,</span><span class="n">DurationTime</span><span class="p">,</span><span class="n">DvcNm</span><span class="p">,</span><span class="n">PlineNm</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">[</span><span class="n">E_EquipmentFailureInfo_Pro</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">BBdbR_PlineBase</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">WorkSectionId</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">WorkSectionId</span><span class="w">		
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">where</span><span class="w"> </span><span class="n">FaultStartTime</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="o">@</span><span class="n">StartTm</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">@</span><span class="n">EndTm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">and</span><span class="w"> </span><span class="n">PlineNm</span><span class="o">=@</span><span class="n">PlineNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="k">Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> 	</span><span class="n">DATEPART</span><span class="p">(</span><span class="n">WEEK</span><span class="p">,</span><span class="n">FaultStartTime</span><span class="p">),</span><span class="n">DvcNm</span><span class="p">,</span><span class="k">Sum</span><span class="p">(</span><span class="n">DurationTime</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="w"> </span><span class="n">SumTm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">StopNum</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">@</span><span class="n">InnerData</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">DvcNm</span><span class="p">,</span><span class="n">DATEPART</span><span class="p">(</span><span class="n">WEEK</span><span class="p">,</span><span class="n">FaultStartTime</span><span class="p">),</span><span class="n">DvcNm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">RETURN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span></code></pre></div><h2 id="3设备运行趋势曲线报表展示">3.设备运行趋势曲线报表展示</h2>
<h3 id="思路分析">思路分析</h3>
<p>折线图</p>
<p>分类：设备名称</p>
<p>系列：异常时长及异常次数</p>
<h3 id="sql语句-2">SQL语句</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> 	</span><span class="n">DvcNm</span><span class="p">,</span><span class="k">Sum</span><span class="p">(</span><span class="n">DurationTime</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="w"> </span><span class="n">SumTm</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">StopNum</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">[</span><span class="n">E_EquipmentFailureInfo_Pro</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">DvcNm</span><span class="w">
</span></span></span></code></pre></div>
</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">相关文章</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/p/finebinote/">
        
        

        <div class="article-details">
            <h2 class="article-title">FineBInote</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/windows%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E5%A4%87%E5%BF%98/">
        
        

        <div class="article-details">
            <h2 class="article-title">windows服务开发备忘</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 think hy how to learn
    </section>
    
    <section class="powerby">
         <br />
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<!doctype html>
<html lang="en">
<head>
   
</head>









<body>
</body>

</html>


    </body>
</html>
